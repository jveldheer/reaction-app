<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Audible Reaction Timers</title>
  <style>
    :root { --btn:#000; --btnText:#fff; --warn:#ff4444; }
    body  { font-family:sans-serif; text-align:center; padding:20px; }
    section      { display:none; }
    section.show { display:block; }
    img.logo     { max-width:200px; margin-bottom:15px; }
    button,input { font-size:1.1em; padding:12px 22px; margin:8px; border:none; border-radius:5px; }
    .primary     { background:var(--btn); color:var(--btnText); cursor:pointer; }
    #countdown   { font-size:3em; margin-top:20px; }
    #ringerBar   {position:fixed;bottom:0;left:0;width:100%;background:var(--warn);color:#fff;font-weight:bold;padding:10px;z-index:999;}
  </style>
</head>
<body>

<!-- Landing -->
<section id="landing" class="show">
  <img src="vlvl16x9.png" class="logo" alt="VLVL Logo">
  <h2>Select a Timer</h2>
  <button class="primary" data-mode="clap">Audible Clap Timer</button><br>
  <button class="primary" data-mode="number">Audible Number Timer</button><br>
  <button class="primary" data-mode="direction">Audible Direction Timer</button>
</section>

<!-- Timer Setup / Run -->
<section id="timer">
  <img src="vlvl16x9.png" class="logo" alt="VLVL Logo">
  <h1 id="timerTitle"></h1>
  <label>Training Duration (seconds):</label><br>
  <input type="number" id="duration" min="1"><br>
  <button id="startBtn" class="primary">Start Drill</button>
  <div id="countdown"></div>
  <button id="backBtn" class="primary" style="margin-top:25px;">‚Üê Back</button>
</section>

<!-- Ringer reminder -->
<div id="ringerBar">üîà Make sure your device's Ringer is set to ON</div>

<script>
/* ---------- basic utilities ---------- */
const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
const synth    = window.speechSynthesis;
const landing  = document.getElementById('landing');
const timerSec = document.getElementById('timer');
const titleEl  = document.getElementById('timerTitle');
const durEl    = document.getElementById('duration');
const startBtn = document.getElementById('startBtn');
const backBtn  = document.getElementById('backBtn');
const countEl  = document.getElementById('countdown');

let mode = '';      // clap | number | direction
let lastVal = null; // last number/direction spoken for no-repeat rule

function show(el){ el.classList.add('show'); }
function hide(el){ el.classList.remove('show'); }

function playTone(freq=1000,dur=200,type='sine'){
  const osc=audioCtx.createOscillator(), g=audioCtx.createGain();
  osc.connect(g); g.connect(audioCtx.destination);
  osc.type=type; osc.frequency.setValueAtTime(freq,audioCtx.currentTime);
  g.gain.setValueAtTime(1,audioCtx.currentTime);
  osc.start(); osc.stop(audioCtx.currentTime+dur/1000);
}

function playClap(){ playTone(2200,120,'square'); }

function speak(text){
  const utter = new SpeechSynthesisUtterance(text);
  utter.rate = 1; utter.pitch = 1;
  synth.cancel(); synth.speak(utter);
}

/* ---------- landing buttons ---------- */
landing.querySelectorAll('button[data-mode]').forEach(btn=>{
  btn.onclick = ()=>{
    mode = btn.dataset.mode;
    titleEl.textContent = ({
      clap:'Audible Clap Timer',
      number:'Audible Number Timer',
      direction:'Audible Direction Timer'
    })[mode];
    durEl.value='';
    countEl.textContent='';
    hide(landing); show(timerSec);
  };
});

/* ---------- back ---------- */
backBtn.onclick = ()=>{ hide(timerSec); show(landing); };

/* ---------- main drill ---------- */
startBtn.onclick = ()=>{
  audioCtx.resume().then(()=>{
    const totalMs = parseInt(durEl.value)*1000;
    if(isNaN(totalMs)||totalMs<=0){ alert('Enter a valid time'); return; }
    durEl.disabled=true; startBtn.disabled=true; backBtn.disabled=true;
    let countdown=3;
    function beepCnt(){
      if(countdown>0){
        countEl.textContent=countdown; playTone();
        countdown--; setTimeout(beepCnt,1000);
      }else{
        countEl.textContent='Go!';
        if(mode==='clap') playClap(); else triggerPrompt(); // first signal
        const end = Date.now()+totalMs;
        schedule(end);
        setTimeout(()=>{
          // finish
          playTone(250,800,'square');
          durEl.disabled=false; startBtn.disabled=false; backBtn.disabled=false;
          countEl.textContent='';
        },totalMs);
      }
    }
    beepCnt();
    // core scheduling
    function schedule(endTime){
      if(Date.now()<endTime-400){
        const next = Math.random()*1500+500; // 0.5-2 s
        setTimeout(()=>{
          if(Date.now()<endTime-200){
            if(mode==='clap')       playClap();
            else                    triggerPrompt();
            schedule(endTime);
          }
        },next);
      }
    }
    function triggerPrompt(){
      if(mode==='number'){
        let num;
        do{ num = Math.floor(Math.random()*5)+1; }while(num===lastVal);
        lastVal=num; speak(String(num));
      }else if(mode==='direction'){
        const dirs=['right','left','back','forward'];
        let dir;
        do{ dir = dirs[Math.floor(Math.random()*dirs.length)]; }while(dir===lastVal);
        lastVal=dir; speak(dir);
      }
    }
  });
};
</script>
</body>
</html>
