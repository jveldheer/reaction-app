<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audible Reaction Timers</title>
<style>
  :root { --btn:#000; --btnText:#fff; --warn:#ff4444; }
  body  { font-family:sans-serif; text-align:center; padding:20px; }
  section      { display:none; }
  section.show { display:block; }
  img.logo     { max-width:200px; margin-bottom:15px; }
  button,input { font-size:1.1em; padding:12px 22px; margin:8px; border:none; border-radius:5px; }
  .primary     { background:var(--btn); color:var(--btnText); cursor:pointer; }
  #duration    { border:2px solid #000; width:140px; text-align:center; }
  #countdown   { font-size:3em; margin-top:20px; }
  #ringerBar   {position:fixed;bottom:0;left:0;width:100%;background:var(--warn);color:#fff;font-weight:bold;
                padding:10px;z-index:999;}
</style>
</head>
<body>

<!-- Landing -->
<section id="landing" class="show">
  <img src="vlvl16x9.png" class="logo" alt="VLVL Logo">
  <h2>Select a Timer</h2>
  <button class="primary" data-mode="clap">Audible Clap Timer</button><br>
  <button class="primary" data-mode="number">Audible Number Timer</button><br>
  <button class="primary" data-mode="direction">Audible Direction Timer</button>
</section>

<!-- Timer Page -->
<section id="timer">
  <img src="vlvl16x9.png" class="logo" alt="VLVL Logo">
  <h1 id="timerTitle"></h1>
  <label>Training Duration (seconds):</label><br>
  <input type="number" id="duration" min="1"><br>
  <button id="startBtn" class="primary">Start Drill</button>
  <div id="countdown"></div>
  <button id="backBtn" class="primary" style="margin-top:25px;">‚Üê Back</button>
</section>

<!-- Ringer reminder -->
<div id="ringerBar">üîà Make sure your device's Ringer is set to ON</div>

<script>
/* ---------- references ---------- */
const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
const synth    = window.speechSynthesis;
let defaultVoice = null;

const landing  = document.getElementById('landing');
const timerSec = document.getElementById('timer');
const titleEl  = document.getElementById('timerTitle');
const durEl    = document.getElementById('duration');
const startBtn = document.getElementById('startBtn');
const backBtn  = document.getElementById('backBtn');
const countEl  = document.getElementById('countdown');

let mode='', lastVal=null;

/* ---------- helpers ---------- */
const show     = el => el.classList.add('show');
const hide     = el => el.classList.remove('show');

function playTone(freq=1000,dur=200,type='sine'){
  const osc=audioCtx.createOscillator(), g=audioCtx.createGain();
  osc.type=type; osc.frequency.value=freq;
  osc.connect(g); g.connect(audioCtx.destination);
  g.gain.setValueAtTime(1,audioCtx.currentTime);
  osc.start(); osc.stop(audioCtx.currentTime+dur/1000);
}

/* white-noise burst = clap */
function playClap(){
  const len = audioCtx.sampleRate*0.15;
  const buf = audioCtx.createBuffer(1,len,audioCtx.sampleRate);
  const data= buf.getChannelData(0);
  for(let i=0;i<len;i++) data[i]=(Math.random()*2-1)*Math.pow(1-i/len,2);
  const src = audioCtx.createBufferSource();
  src.buffer = buf; src.connect(audioCtx.destination); src.start();
}

/* robust speech helper */
function speak(text){
  const speakNow = () =>{
    const utter = new SpeechSynthesisUtterance(text);
    if(defaultVoice) utter.voice = defaultVoice;
    utter.rate = 1; utter.pitch = 1; utter.volume = 1;
    synth.cancel();               // stop overlaps
    synth.speak(utter);
  };

  // ensure voices are loaded
  const voicesLoaded = synth.getVoices().length;
  if(!voicesLoaded){
    synth.addEventListener('voiceschanged', () => {
      defaultVoice = synth.getVoices().find(v=>/en/i.test(v.lang)) || null;
      speakNow();
